// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * PicoCalc hardware device tree definitions for Luckfox Lyra board
 */

/****** Picocalc i2c Bus ******/
&pinctrl {
    rm_io11 {
        rm_io11_i2c2_sda: rm-io11-i2c2-sda {
            rockchip,pins =
                <0 RK_PB3 35 &pcfg_pull_none>;
        };
    };

    rm_io10 {
        rm_io10_i2c2_scl: rm-io10-i2c2-scl {
            rockchip,pins =
                <0 RK_PB2 34 &pcfg_pull_none>;
        };
    };
};

&i2c2{
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io10_i2c2_scl &rm_io11_i2c2_sda>;
	max-frequency = <400000>;

	/****** Picocalc STM32 Firmware ******/
	picocalc_mfd: picocalc-mfd@1f {
		status = "okay";
		compatible = "picocalc-mfd","picocalc-kbd";
		reg = <0x1F>;
		poweroff = <0x0E>;

		/****** Keyboard Subsystem ******/
		picocalc_mfd_kbd: picocalc-mfd-kbd@04 {
			compatible = "picocalc-mfd-kbd";
			reg = <0x04>;
			fifo = <0x09>;
		};

		/****** Battery Subsystem ******/
		picocalc_mfd_bms: picocalc-mfd-bms@0b {
			compatible = "picocalc-mfd-bms";
			reg = <0x0B>;
		};

		/****** Display Backlight ******/
		picocalc_mfd_bkl: picocalc-mfd-bkl@05 {
			compatible = "picocalc-mfd-bkl";
			reg = <0x05>;
			default-brightness = <128>;
			max-brightness = <255>;
		};

		/****** Keyboard Backlight ******/
		picocalc_mfd_led: picocalc-mfd-led@0a {
			compatible = "picocalc-mfd-led";
			linux,default-trigger = "backlight";
			reg = <0x0A>;
			label = "picocalc_mfd_led:kbd_backlight";
		};
	};
};

/****** Picocalc Display ******/
&pinctrl {
	ili9488 {
		ili9488_pins: ili9488-pins {
			rockchip,pins =
				<0 RK_PA3 RK_FUNC_GPIO &pcfg_pull_none>,
				<0 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
};

&spi0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io4_spi0_csn0 &rm_io5_spi0_miso &rm_io6_spi0_mosi &rm_io7_spi0_clk>;
	num-cs = <1>;

	ili9488: ili9488@0 {
		status = "okay";
		compatible = "picocalc,spilcd", "ilitek,ili9488";
		spi-max-frequency = <80000000>;
		reg = <0>;
		pinctrl-names = "default";
		pinctrl-0 = <&ili9488_pins>;
		fps = <30>;
		width = <320>;
		height = <320>;

		backlight = <&picocalc_mfd_bkl>;
		/***** DRM driver Parameter names ******/
		dc-gpios = <&gpio0 RK_PA3 GPIO_ACTIVE_HIGH>;
        reset-gpios = <&gpio0 RK_PA2 GPIO_ACTIVE_HIGH>;
		rotate = <0>;
        buswidth = <8>;
	};
};

/****** Picocalc SD Card Reader ******/
&spi1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io29_spi1_clk &rm_io28_spi1_mosi &rm_io31_spi1_miso &rm_io30_spi1_csn0>;

	spi_mmc: mmc@0 {
		compatible = "mmc-spi-slot";
		reg = <0>;  // Chip Select 0
		spi-max-frequency = <50000000>;
		cd-gpios = <&gpio1 RK_PB2 GPIO_ACTIVE_LOW>;
		disable-wp;
		no-sdio;
		voltage-ranges = <3300 3300>;
		vmmc-supply = <&vcc_3v3>;
		vqmmc-supply = <&vcc_3v3>;
		no-1-8-v;
	};
};

/*
 * PicoCalc audio (M0 delta-sigma or PWM) is configured via runtime device tree
 * overlays. Apply one of:
 *   - m0-audio overlay: picocalc,snd-m0 (default firmware path)
 *   - pwm-audio overlay: fsl,picocalc-snd-pwm (hardware mod)
 * See devicetree-overlays/m0-audio-overlay.dts and pwm-audio-overlay.dts.
 */
